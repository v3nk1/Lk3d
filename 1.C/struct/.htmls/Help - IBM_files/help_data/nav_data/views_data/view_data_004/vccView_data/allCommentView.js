var topicList=new Array(); var hottopicList=new Array(); var currentTopic; var idList=new Array(); var topicHref; var currentOffset; var currentNum; var pageNum; var tuneFactor=6; var allExpanded; var initialed=false; var myUID; var myIntranetID; var myDisplayName; var uid; var intranetID; var displayName; var previousID; var askAll=false; function Topic(_1,_2,id){ this.comments=new Array(); this.title=_1; this.href=_2; this.id=id; }; function HotTopic(_4,_5,_6){ this.title=_4; this.amount=_5; this.href=_6; }; function Comment(_7,_8,_9,_a,_b,_c,_d,_e){ this.htmlID=_7; this.summary=_8; this.uid=_9; this.intranetID=_a; this.type=_b; this.disposition=_c; this.time=_d; this.cid=_e; this.toHTML=generateLiHtml; this.toLI=creatCommentLI; }; function creatCommentLI(){ var _f=document.createElement("LI"); _f.innerHTML=this.toHTML(); return _f; }; function generateLiHtml(){ var alt=this.summary; alt=alt.replace(/\'/g,"&#39;"); var _11; if(this.htmlID){ var _12=FreeSelect.create(decodeURIComponent(this.htmlID)); if(_12.type=="page"){ _11="<p class='dt'> <img src='../vcc/images/pagecomments.gif'/><a title=\""+alt+" ["+window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.LABEL_PAGE_LEVEL+"]\" href='"+topicHref+"&htmlid="+this.htmlID+"&cid="+this.cid+"&"+"' >"+this.summary+" </a></p><p class='bt'>"; }else{ if(_12.type=="element"){ _11="<p class='dt'> <img src='../vcc/images/elementcomments.gif'/><a title=\""+alt+" ["+window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.LABEL_ELEMENT_LEVEL+"]\" href='"+topicHref+"&htmlid="+this.htmlID+"&cid="+this.cid+"&"+"' >"+this.summary+" </a></p><p class='bt'>"; }else{ if(_12.type=="free"){ _11="<p class='dt'> <img src='../vcc/images/elementcomments.gif'/><a title=\""+alt+" ["+window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.LABEL_SELECTION_LEVEL+"]\" href='"+topicHref+"&htmlid="+this.htmlID+"&cid="+this.cid+"&"+"' >"+this.summary+" </a></p><p class='bt'>"; } } } } if(window.top.HelpFrame.ContentFrame.vccFrames.isInternalMode&&this.disposition!=-1){ _11+=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.LABEL_COMMENTS_DISPOSITION+": <span class='disposition' id='"+this.time+"' name='disposition'>"+dispositionList[this.disposition]+"</span>"; } _11+=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.LABEL_COMMENTS_TIME+": "+this.time+"</p>"; return _11; }; function initial(){ allExpanded=false; getComments(); }; function getHottopics(){ var _13="../HotTopicServlet?action=hottopic"+"&uniquerequestid="+new Date().getTime(); req=AJAX.newRequest(); req.onreadystatechange=initialHottopics; req.open("GET",_13,true); req.setRequestHeader("Content-Type","text/xml; charset=UTF-8"); if(window.XMLHttpRequest){ req.send(null); }else{ if(window.ActiveXObject){ req.send(); } } }; function getComments(){ var _14=document.getElementById("owner"); var _15=(this.intranetID=="null"||this.intranetID=="undefined"||this.intranetID==null)?"Anonymous":this.displayName; if(_15=="Anonymous"){ _14.innerHTML=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.TIP_ALL_COMMENTS_SIGN_IN; }else{ var _16=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.TIP_ALL_COMMENTS; _14.innerHTML=window.top.HelpFrame.ContentFrame.vccFrames.dojo.string.substitute(_16,{username:_15}); } if(null==this.uid){ hidePrevious(); hideNext(); return; } var _17="../AllCommentServlet?action=getall"+"&uid="+this.uid+"&uniquerequestid="+new Date().getTime(); req=AJAX.newRequest(); req.onreadystatechange=initialTopics; req.open("GET",_17,true); req.setRequestHeader("Content-Type","text/xml; charset=UTF-8"); if(window.XMLHttpRequest){ req.send(null); }else{ if(window.ActiveXObject){ req.send(); } } }; function showHTLabel(len){ removeHTLabel(); var _19=document.getElementById("holder"); _19.style.display="none"; var _1a=document.createElement("div"); var _1b=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.TIP_HOT_TOPICS; _1a.innerHTML=window.top.HelpFrame.ContentFrame.vccFrames.dojo.string.substitute(_1b,{length:len}); var _1c=document.createElement("ul"); _1c.id="htroot"; var _1d=document.getElementById("root"); _1c.appendChild(_1a); document.getElementById("topicList").insertBefore(_1c,_1d); document.getElementById("topicList").removeChild(_1d); }; function removeHTLabel(){ document.getElementById("placeholder").style.display="block"; var _1e=document.getElementById("htroot"); if(_1e){ document.getElementById("topicList").removeChild(_1e); var _1f=document.createElement("ul"); _1f.id="root"; document.getElementById("topicList").appendChild(_1f); } }; function initialHottopics(){ if(req.readyState==4){ if(req.status==200){ var _20=req.responseXML; if(_20!=null){ hottopicList=new Array(); topics=_20.getElementsByTagName("hottopic"); for(var i=0;i<topics.length;i++){ var _22=getElementText(topics[i],"title"); var _23=getElementText(topics[i],"amount"); var _24=getElementText(topics[i],"href"); hottopicList[i]=new HotTopic(_22,_23,_24); } showHTLabel(topics.length); var _25=document.getElementById("htroot"); for(var i=0;i<hottopicList.length;i++){ _25.appendChild(createHotLI(hottopicList[i])); } resizeVertical("topicList","placeholder","navigation",100,5); } }else{ alert(window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.ALERT_INIT_TOPIC); } } }; function initialTopics(){ var _26; if(req.readyState==4){ if(req.status==200){ var _27=req.responseXML; if(_27!=null){ _26=_27.getElementsByTagName("topic"); for(var i=0;i<_26.length;i++){ var _29=getElementText(_26[i],"title"); var _2a=getElementText(_26[i],"href"); topicList[i]=new Topic(_29,_2a,i); idList[idList.length]=i; } computeLines(); currentOffset=0; initialNavigation(); initialed=true; showTopics(currentOffset); } }else{ var _2b=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.ALERT_INIT_TOPIC; alert(window.top.HelpFrame.ContentFrame.vccFrames.dojo.string.substitute(_2b,{message:req.statusText})); } } }; function initialNavigation(){ hidePrevious(); showNext(); if(pageNum>=idList.length){ hideNext(); parent.vccViewFrame.document.getElementById("navigation").style.display="none"; } }; function computeLines(){ resizeVertical("topicList","placeholder","navigation",100,5); try{ var _2c=document.getElementById("topicList"); var _2d=document.getElementById("owner"); var _2e=_2c.offsetHeight/(_2d.offsetHeight+tuneFactor); pageNum=Math.floor(_2e); if(pageNum<1){ pageNum=1; } } catch(ex){ console.dir(ex); } }; function showTopics(_2f){ computeLines(); var _30=document.getElementById("root"); _30.style.visibility="visible"; for(var i=_2f;i<idList.length&&i<_2f+pageNum;i++){ _30.appendChild(createLI(topicList[idList[i]])); } }; function loadPreviousPage(){ computeLines(); var _32=currentOffset-pageNum; if(_32<=0){ _32=0; hidePrevious(); }else{ showPrevious(); } if(pageNum>=idList.length){ hideNext(); }else{ showNext(); } document.getElementById("topicList").innerHTML="<ul class='expanded' id='root'></ul>"; showTopics(_32); currentOffset=_32; allExpanded=false; }; function loadNextPage(){ var _33=currentOffset+pageNum; if(_33>idList.length){ return; } computeLines(); if(_33+pageNum>=idList.length){ hideNext(); } showPrevious(); document.getElementById("topicList").innerHTML="<ul class='expanded' id='root'></ul>"; showTopics(_33); currentOffset=_33; allExpanded=false; }; function showPrevious(){ parent.vccViewFrame.document.getElementById("navigation").style.display="block"; document.getElementById("previous").className="enabled"; }; function showNext(){ parent.vccViewFrame.document.getElementById("navigation").style.display="block"; document.getElementById("next").className="enabled"; }; function hidePrevious(){ document.getElementById("previous").className="h"; }; function hideNext(){ document.getElementById("next").className="h"; }; function createHotLI(_34){ var _35=document.createElement("LI"); var _36=document.createElement("A"); var _37=document.createElement("span"); _36.dir=direction_anchor; _36.href="../topic/"+_34.href; _36.innerHTML="<img src='images/d_topic.gif' alt=''>"; _36.appendChild(document.createTextNode(_34.title)); _36.name="topic"; _36.title=_34.title; var _38=window.top.HelpFrame.NavFrame.ViewsFrame.window.frames.toc; var amt=_34.amount; var _3a=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.LABEL_COMMENTS_L; _37.innerHTML=window.top.HelpFrame.ContentFrame.vccFrames.dojo.string.substitute(_3a,{amount:amt}); _35.appendChild(_36); _35.appendChild(_37); return _35; }; function createLI(_3b){ var _3c=document.createElement("LI"); var _3d=document.createElement("IMG"); var _3e=document.createElement("A"); _3d.src="images/plus.gif"; _3d.className="collapsed"; _3d.onclick=clickHandler; _3d.alt=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.ALT_TOPIC_CLOSED; _3e.href="../topic/"+_3b.href; _3e.id=_3b.id; _3e.innerHTML="<img src='images/container_obj.gif' alt=''>"; _3e.appendChild(document.createTextNode(_3b.title)); _3e.name="topic"; _3e.title=_3b.title; _3c.appendChild(_3d); _3c.appendChild(_3e); return _3c; }; function clickHandler(e){ var _40=getTarget(e); var _41=_40.nextSibling.href; currentTopic=_40.nextSibling.id; showComment(_41,currentTopic); expand(_40); }; function showComment(_42,_43){ topicHref=_42; var _44=_42.indexOf("?"); var _45=_42.substring(_44+1); var _46=window.top.HelpFrame.ContentFrame.vccFrames.vccUtils.getTimezoneName(); var _47="../AllCommentServlet?action=getcomments&"+_45+"&uid="+this.uid+"&bTimezone="+_46+"&uniquerequestid="+new Date().getTime(); req=AJAX.newRequest(); req.onreadystatechange=showComments; req.open("GET",_47,true); req.setRequestHeader("Content-Type","text/xml; charset=UTF-8"); if(window.XMLHttpRequest){ req.send(null); }else{ if(window.ActiveXObject){ req.send(); } } }; function showComments(){ var _48; if(req.readyState==4){ try{ if(req.status==200){ var _49=req.responseXML; if(_49!=null){ if(_49.getElementsByTagName("error").length!=0){ if(_49.getElementsByTagName("error")[0].firstChild.nodeValue=="Session timeout"){ window.top.location.reload(); } }else{ _48=_49.getElementsByTagName("comment"); var _4a=document.getElementById(currentTopic); if(_48.length==0){ refreshAll(); }else{ var _4b=document.createElement("UL"); _4b.className="liststyle"; _4a.parentNode.appendChild(_4b); for(var i=0;i<_48.length;i++){ var _4d=getElementText(_48[i],"htmlID"); var _4e=getElementText(_48[i],"subject"); var _4f=getElementText(_48[i],"typeID"); var _50=getElementText(_48[i],"dispositionID"); var _51=getElementText(_48[i],"uid"); var _52=getElementText(_48[i],"intranetID"); var _53=getElementText(_48[i],"timestamp"); var cid=getElementText(_48[i],"cid"); topicList[currentTopic].comments[cid]=new Comment(_4d,_4e,_51,_52,_4f,_50,_53,cid); _4b.appendChild(topicList[currentTopic].comments[cid].toLI()); } } } } if(askAll){ var _55=document.getElementById(currentTopic); if(_55){ if(_55.parentNode.nextSibling){ showHandler(_55.parentNode.nextSibling.firstChild); }else{ askAll=false; } } } }else{ alert(req.statusText); } } catch(e){ alert(window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.ALERT_CONNECT_SERVER); console.dir(e); } } }; function showHandler(_56){ if(_56){ var _57=_56.nextSibling.href; currentTopic=_56.nextSibling.id; if(_56.onclick==clickHandler){ showComment(_57,currentTopic); expand(_56); }else{ _56.src="images/minus.gif"; _56.className="expanded"; _56.onclick=hideComment; _56.parentNode.lastChild.className="liststyle"; var _58=document.getElementById(currentTopic); if(_58.parentNode.nextSibling){ showHandler(_58.parentNode.nextSibling.firstChild); }else{ askAll=false; } } } }; function expand(_59){ _59.src="images/minus.gif"; _59.className="expanded"; _59.onclick=hideComment; _59.alt=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.ALT_TOPIC_OPEN; }; function hideComment(e){ var _5b=getTarget(e); var _5c=_5b; _5c.src="images/plus.gif"; _5c.className="collapsed"; _5c.alt=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.ALT_TOPIC_CLOSED; _5c.onclick=expandUL; _5c.parentNode.lastChild.className="collapsed"; }; function expandUL(e){ var _5e=getTarget(e); var _5f=_5e; _5f.src="images/minus.gif"; _5f.className="expanded"; _5f.alt=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.ALT_TOPIC_OPEN; _5f.onclick=hideComment; _5f.parentNode.lastChild.className="liststyle"; }; function refresh(_60){ }; function expandAllTopics(){ askAll=true; var _61=getFirstChild(getFirstChild(document.getElementById("root"))); showHandler(_61); }; function collapseAllTopics(){ document.getElementById("topicList").innerHTML="<ul class='expanded' id='root'></ul>"; showTopics(currentOffset); }; function showHotTopic(){ if(isMozilla){ document.addEventListener("keydown",keyDownHandler,true); }else{ if(isIE){ document.onkeydown=keyDownHandler; } } hideETSView(); this.previousID=null; initialForHotTopics(); getHottopics(); resizeVertical("topicList","placeholder","navigation",100,5); }; function hideHandler(_62){ hideComment(_62); if(_62.parentNode.nextSibling){ hideHandler(_62.parentNode.nextSibling.firstChild); }else{ } }; function getTarget(e){ if(window.event){ return window.event.srcElement; }else{ return e.target; } }; function getFirstChild(_64){ if(_64){ var _65=_64.firstChild; while(_65&&_65.nodeType!=1){ _65=_65.nextSibling; } return _65; } }; function refreshAll(){ if(isMozilla){ document.addEventListener("keydown",keyDownHandler,true); }else{ if(isIE){ document.onkeydown=keyDownHandler; } } hideETSView(); initialForAllComments(); removeHTLabel(); document.getElementById("holder").style.display="block"; document.getElementById("placeholder").style.display="block"; document.getElementById("buttonmessage").style.display="none"; document.getElementById("topicList").innerHTML="<ul class='expanded' id='root'></ul>"; topicList=new Array(); hottopicList=new Array(); currentTopic=null; idList=new Array(); topicHref=null; askAll=false; initialed=false; initial(); }; function getTarget(e){ var _67; if(isMozilla){ _67=e.target; }else{ if(isIE){ _67=window.event.srcElement; } } return _67; }; function keyDownHandler(e){ var key; if(isIE){ key=window.event.keyCode; }else{ if(isMozilla){ key=e.keyCode; } } if(key<37||key>40){ return true; } if(isMozilla){ e.cancelBubble=true; }else{ if(isIE){ window.event.cancelBubble=true; } } if(key==39){ var _6a=getTarget(e); if(!_6a){ return; } if(_6a.name=="topic"&&_6a.previousSibling&&_6a.previousSibling.className=="collapsed"){ if(isIE){ _6a.previousSibling.click(); }else{ var evt=document.createEvent("MouseEvents"); evt.initEvent("click",true,true); _6a.previousSibling.dispatchEvent(evt); } } }else{ if(key==37){ var _6a=getTarget(e); if(!_6a){ return; } if(_6a.name=="topic"&&_6a.previousSibling&&_6a.previousSibling.className=="expanded"){ if(isIE){ _6a.previousSibling.click(); }else{ var evt=document.createEvent("MouseEvents"); evt.initEvent("click",true,true); _6a.previousSibling.dispatchEvent(evt); } } } } return true; }; if(isMozilla){ document.addEventListener("keydown",keyDownHandler,true); }else{ if(isIE){ document.onkeydown=keyDownHandler; } } function onShow(){ if(this.previousID!=this.uid){ refreshAll(); this.previousID=this.uid; } }; function reSize(){ resizeVertical("topicList","placeholder","navigation",100,5); }; function setAccountInfo(_6c,_6d,_6e){ if(null!=_6e&&"null"!=_6e&&""!=_6e){ this.myDisplayName=_6e; }else{ this.myDisplayName=_6d; } this.myUID=_6c; this.myIntranetID=_6d; this.uid=this.myUID; this.intranetID=myIntranetID; this.displayName=this.myDisplayName; this.previousID=this.uid; }; function resetAccountInfo(){ this.myUID=null; this.myIntranetID=null; }; function showMyComments(){ this.uid=this.myUID; this.intranetID=this.myIntranetID; this.displayName=this.myDisplayName; this.previousID=this.myUID; refreshAll(); }; function initialForHotTopics(){ parent.vccViewFrame.document.getElementById("navigation").style.display="none"; parent.vccToolbarFrame.document.getElementById("titleText").innerHTML=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.LABEL_HOTTOPICS; hidePrevious(); hideNext(); }; function initialForAllComments(){ parent.vccViewFrame.document.getElementById("navigation").style.display="none"; parent.vccToolbarFrame.document.getElementById("titleText").innerHTML=window.top.HelpFrame.ContentFrame.vccFrames.nlsStrings.LABEL_COMMENTS_U; }; function hideETSView(){ try{ etsResult.hideETS(); } catch(e){ return false; } }; 