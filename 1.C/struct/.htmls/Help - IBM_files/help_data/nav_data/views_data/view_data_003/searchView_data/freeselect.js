var FreeSelect={_topID:"_vcc_freeselect_top_",_bottomID:"_vcc_freeselect_bottom_",_document:document,_window:window,setWindow:function(_1){ this._window=_1; this._document=this._window.document; },create:function(_2){ var _3=eval("("+_2+")"); return new FreeSelect.Selection(_3.type,_3.target); },Selection:function(_4,_5){ this.type=_4; if(_4=="free"){ this.target=new FreeSelect._FreeSelection(_5.parent,_5.start,_5.end); }else{ this.target=_5; } },_FreeSelection:function(_6,_7,_8){ this.parent={id:_6.id}; this.start={type:_7.type,id:_7.id,index:_7.index,offset:_7.offset}; this.end={type:_8.type,id:_8.id,index:_8.index,offset:_8.offset}; },_UTIL:{_isSpace:function(c){ switch(c){ case "\t": case "\n": case "\v": case "\f": case "\r": case " ": return true; default: return false; } },_normalizeOffset:function(_a,_b){ if(_a._vcc_in_pre||_a.parentNode._vcc_in_pre){ return _b; } var _c=_a.data; var _d=_c.substr(0,_b); var _d=_d.replace(/(\s)\s+/g,"$1"); if(_d.length!=0){ if(this._isSpace(_d.charAt(0))){ return _d.length-1; } } return _d.length; },_restoreOffset:function(_e,_f){ if(_e.data.length<=_f){ return _e.data.length; } if(_e._vcc_in_pre||_e.parentNode._vcc_in_pre){ return _f; } var _10=_e.data; var _11=true; var _12=0; for(var i=0;i<_f;++_12){ if(i>=_10.length){ alert("Error:_restoreOffset"); break; } var c=_10.charAt(_12); if(this._isSpace(c)){ if(!_11){ ++i; _11=true; } }else{ _11=false; ++i; } } return _12; },_isBlank:function(_15){ for(var i=0;i<_15.length;++i){ if(!this._isSpace(_15.charAt(i))){ return false; } } return true; },_isIgnoreElement:function(_17){ return _17._vccmark; },_isIgnoreNode:function(_18){ if(!_18||!_18.nodeType||(_18.nodeType!=1&&_18.nodeType!=3)){ return true; } if(_18.nodeType==3){ if(this._isBlank(_18.data)){ return true; } }else{ if(this._isIgnoreElement(_18)){ return true; } } return false; },_findNextNode:function(_19){ while(!_19.nextSibling){ if(_19.parentNode){ _19=_19.parentNode; }else{ return null; } } _19=_19.nextSibling; while(_19.firstChild){ _19=_19.firstChild; } return _19; },_findPreviousNode:function(_1a){ while(!_1a.previousSibling){ if(_1a.parentNode){ _1a=_1a.parentNode; }else{ return null; } } _1a=_1a.previousSibling; while(_1a.lastChild){ _1a=_1a.lastChild; } return _1a; },_normalizeNode:function(_1b,_1c){ if(_1b.nodeType==3){ return _1b; }else{ if(_1c){ var _1d=_1b; while(this._isIgnoreNode(_1d)){ _1d=this._findNextNode(_1b); if(!_1d){ return null; } } return _1d; }else{ var _1e=_1b; while(this._isIgnoreNode(_1e)){ _1e=this._findPreviousNode(_1e); if(!_1e){ return null; } } return _1e; } } },_normalizeIndex:function(_1f,_20){ if(_20==0){ return 0; } var _21=_1f.childNodes; var _22=0; for(var i=1;i<=_20&&i<=_21.length;++i){ var _24=_21[i-1]; if(this._isIgnoreNode(_24)){ _22++; } } return _20-_22; },_restoreIndex:function(_25,_26,_27){ var _28=_25.childNodes; var _29=0; var i=0; var _2b=_26+1; for(i=0;_29!=_2b&&i<_28.length;++i){ var _2c=_28[i]; if(!this._isIgnoreNode(_2c)){ ++_29; } } var _2d=i-1; var _2e=_28[_2d].nodeType; if(_27){ for(;i<_28.length;++i){ var _2c=_28[i]; if(this._isIgnoreNode(_2c)){ continue; }else{ break; } } } if(_28[i-1].nodeType==_2e){ return i-1; }else{ return _2d; } },_getIndexInParent:function(_2f){ var _30=_2f.parentNode.childNodes; for(var i=0;i<_30.length;++i){ if(_2f==_30[i]){ return i; } } return -1; }},_IE:{_MAX:999999,_modifySelection:function(_32){ this.clearSelection(); var r=_32.duplicate(); var top=FreeSelect._document.getElementById(FreeSelect._topID); if(top){ r.moveToElementText(top); if(0>=_32.compareEndPoints("EndToEnd",r)){ _32.setEndPoint("EndToEnd",r); } if(0>=_32.compareEndPoints("StartToEnd",r)){ _32.setEndPoint("StartToEnd",r); } } var _35=FreeSelect._document.getElementById(FreeSelect._bottomID); if(_35){ r.moveToElementText(_35); if(0<=_32.compareEndPoints("StartToStart",r)){ _32.setEndPoint("StartToStart",r); } if(0<=_32.compareEndPoints("EndToStart",r)){ _32.setEndPoint("EndToStart",r); } } _32.select(); return _32; },getSelection:function(){ var _36=FreeSelect._document.selection.createRange(); _36=this._modifySelection(_36); var _37=_36.parentElement(); var r=_36.duplicate(); r.moveToElementText(_37); while(_37&&!r.inRange(_36)){ _37=_37.parentNode; r.moveToElementText(_37); } if(!_37.hasChildNodes()){ _37=_37.parentNode; } r=_36.duplicate(); r.collapse(true); var _39=this._findContainer(r,_37,true); r=_36.duplicate(); r.collapse(false); var end=this._findContainer(r,_37,false); if(!_37||!_39||!end||!_37.id||!_39.id||!end.id){ return null; }else{ return new FreeSelect._FreeSelection(_37,_39,end); } },_findContainer:function(_3b,_3c,_3d){ var rs=this.__findContainer(_3b,_3b.duplicate(),_3c,_3d); if(rs==null){ return null; } var _3f=FreeSelect._document.getElementById(rs.id); if(rs.type=="text"){ var _40=_3f.childNodes[rs.index]; rs.offset=FreeSelect._UTIL._normalizeOffset(_40,rs.offset); }else{ var _40=_3f.childNodes[rs.index]; var _41=FreeSelect._UTIL._normalizeNode(_40,_3d); if(_41!=_40){ if(_41.nodeType==3){ rs.type="text"; }else{ rs.type="element"; } rs.index=FreeSelect._UTIL._getIndexInParent(_41); if(!_3d){ rs.index++; } rs.offset=0; _3f=_41.parentNode; rs.id=_3f.id; } } rs.index=FreeSelect._UTIL._normalizeIndex(_3f,rs.index); return rs; },__findContainer:function(_42,r,_44,_45){ r.moveToElementText(_44); var _46=_44.childNodes; r.collapse(true); for(var i=0;i<_46.length;++i){ var _48=_46[i]; if(_48.nodeType==3){ r.moveEnd("character",_48.length); var _49=r.inRange(_42); if(_45){ _49=_49&&(r.compareEndPoints("EndToStart",_42)==1); }else{ _49=_49&&(r.compareEndPoints("StartToEnd",_42)==-1); } if(_49){ var r1=_42.duplicate(); var _4b=r1.moveStart("character",-this._MAX); var _4c=r.moveStart("character",-this._MAX)-_4b; return {id:_44.id,index:i,offset:_4c,type:"text"}; }else{ r.moveStart("character",_48.length); } }else{ if(_48.nodeType==1){ if(!_48.hasChildNodes()){ r.moveToElementText(_48); var _49=r.inRange(_42); if(_45){ _49=_49&&(r.compareEndPoints("EndToStart",_42)==1); }else{ _49=_49&&(r.compareEndPoints("StartToEnd",_42)==-1); } if(_49){ return {id:_44.id,index:i,offset:(_45?0:1),type:"element"}; }else{ r.collapse(false); continue; } }else{ var rs=this.__findContainer(_42,r,_48,_45); if(rs!=null){ return rs; } } }else{ continue; } } } r.moveToElementText(_44); var _49=r.inRange(_42); if(_45){ _49=_49&&(r.compareEndPoints("EndToStart",_42)==1); }else{ _49=_49&&(r.compareEndPoints("StartToEnd",_42)==-1); } if(_49){ var _4e=_44; if(_45){ while(_4e.firstChild){ _4e=_4e.firstChild; } var _4f=""; if(_4e.nodeType==3){ _4f="text"; }else{ if(_4e.nodeType==1){ _4f="element"; } } return {id:_4e.parentNode.id,index:0,offset:0,type:_4f}; }else{ while(_4e.lastChild){ _4e=_4e.lastChild; } var _50=0; var _51=_4e.parentNode.childNodes.length-1; var _4f=""; if(_4e.nodeType==3){ _50=_4e.length; _4f="text"; }else{ if(_4e.nodeType==1){ _50=1; _4f="element"; } } return {id:_4e.parentNode.id,index:_51,offset:_50,type:_4f}; } }else{ r.collapse(false); return null; } },_createRange:function(_52){ if(null==_52){ return null; } var r; var _54=FreeSelect._document.getElementById(_52.parent.id); try{ r=FreeSelect._document.selection.createRange(); r.moveToElementText(_54); } catch(e){ r=FreeSelect._document.body.createTextRange(); r.moveToElementText(_54); } r.collapse(true); this._setRangeEnd(r,_52.end); this._setRangeStart(r,_52.start); return r; },showSelection:function(_55){ var _56=this._createRange(_55); if(null!=_56){ _56.select(); } },showMarker:function(_57){ FreeSelect._UTIL._showMarker(_57); },hideMarker:function(_58){ FreeSelect._UTIL._hideMarker(_58); },_setRangeStart:function(_59,_5a){ var _5b=FreeSelect._document.getElementById(_5a.id); var _5c=FreeSelect._UTIL._restoreIndex(_5b,_5a.index,true); var r=_59.duplicate(); var _5e=_5b.childNodes[_5c]; if(_5e.nodeType==1){ r.moveToElementText(_5e); if(_5a.offset==1){ _59.setEndPoint("StartToEnd",r); }else{ _59.setEndPoint("StartToStart",r); } return; }else{ if(_5e.nodeType==3){ var _5f=FreeSelect._UTIL._restoreOffset(_5e,_5a.offset); for(var i=_5c-1;i>=0;--i){ _5e=_5b.childNodes[i]; if(_5e.nodeType==1){ r.moveToElementText(_5e); _59.setEndPoint("StartToEnd",r); _59.moveStart("character",_5f); return; }else{ if(_5e.nodeType==3){ _5f+=_5e.data.length; } } } r.moveToElementText(_5b); _59.setEndPoint("StartToStart",r); _59.moveStart("character",_5f); } } },_setRangeEnd:function(_61,end){ var _63=FreeSelect._document.getElementById(end.id); var _64=FreeSelect._UTIL._restoreIndex(_63,end.index,false); var r=_61.duplicate(); var _66=_63.childNodes[_64]; if(_66.nodeType==1){ r.moveToElementText(_66); if(end.offset==1){ _61.setEndPoint("EndToEnd",r); }else{ _61.setEndPoint("EndToStart",r); } return; }else{ if(_66.nodeType==3){ var _67=FreeSelect._UTIL._restoreOffset(_66,end.offset); for(var i=_64-1;i>=0;--i){ _66=_63.childNodes[i]; if(_66.nodeType==1){ r.moveToElementText(_66); _61.setEndPoint("EndToEnd",r); _61.moveEnd("character",_67); return; }else{ if(_66.nodeType==3){ _67+=_66.data.length; } } } r.moveToElementText(_63); _61.setEndPoint("EndToStart",r); _61.moveEnd("character",_67); } } },clearSelection:function(){ FreeSelect._document.selection.empty(); },isEmptySelection:function(){ var _69=FreeSelect._document.selection.createRange(); var r=_69.duplicate(); r.collapse(); if(r.isEqual(_69)){ return true; }else{ return false; } }},_FF:{_modifySelection:function(_6b){ this.clearSelection(); var r=FreeSelect._document.createRange(); var top=FreeSelect._document.getElementById(FreeSelect._topID); if(top){ r.selectNode(top); if(0>=_6b.compareBoundaryPoints(Range.END_TO_END,r)){ _6b.setEndAfter(top); } if(0>=_6b.compareBoundaryPoints(Range.END_TO_START,r)){ _6b.setStartAfter(top); } } var _6e=FreeSelect._document.getElementById(FreeSelect._bottomID); if(_6e){ r.selectNode(_6e); if(0<=_6b.compareBoundaryPoints(Range.START_TO_START,r)){ _6b.setStartBefore(_6e); } if(0<=_6b.compareBoundaryPoints(Range.START_TO_END,r)){ _6b.setEndBefore(_6e); } } FreeSelect._window.getSelection().addRange(_6b); return _6b; },getSelection:function(){ var _6f=FreeSelect._window.getSelection(); if(_6f.rangeCount==0){ return null; } var r=_6f.getRangeAt(0); r=this._modifySelection(r); var _71=r.commonAncestorContainer; if(_71.nodeType==3){ _71=_71.parentNode; } var _72={}; _72.offset=r.startOffset; _72.index=0; var _73=r.startContainer; if(_73.nodeType==3){ _72.type="text"; _72.offset=FreeSelect._UTIL._normalizeOffset(_73,_72.offset); _72.index=FreeSelect._UTIL._getIndexInParent(_73); _73=_73.parentNode; }else{ if(_73.nodeType==1){ if(_72.offset==_73.childNodes.length){ _72.type="element"; _72.index=_72.offset-1; _72.offset=1; }else{ var _74=_73.childNodes[_72.offset]; var _75=FreeSelect._UTIL._normalizeNode(_74,true); if(_75==_74){ _72.type="element"; _72.index=_72.offset; _72.offset=0; }else{ if(_75.nodeType==3){ _72.type="text"; }else{ _72.type="element"; } _72.index=FreeSelect._UTIL._getIndexInParent(_75); _72.offset=0; _73=_75.parentNode; } } } } _72.index=FreeSelect._UTIL._normalizeIndex(_73,_72.index); _72.id=_73.id; var end={}; end.offset=r.endOffset; end.index=0; var _77=r.endContainer; if(_77.nodeType==3){ end.type="text"; end.offset=FreeSelect._UTIL._normalizeOffset(_77,end.offset); end.index=FreeSelect._UTIL._getIndexInParent(_77); _77=_77.parentNode; }else{ if(_77.nodeType==1){ if(end.offset==0){ end.type="element"; end.index=0; }else{ var _74=_77.childNodes[end.offset-1]; var _78=FreeSelect._UTIL._normalizeNode(_74,false); if(_78==_74){ end.type="element"; end.index=end.offset-1; end.offset=1; }else{ if(_78.nodeType==3){ end.type="text"; }else{ end.type="element"; } end.index=FreeSelect._UTIL._getIndexInParent(_78); end.offset=1; _77=_78.parentNode; } } } } end.index=FreeSelect._UTIL._normalizeIndex(_77,end.index); end.id=_77.id; if(!_71.id||!_72.id||!end.id){ return null; }else{ return new FreeSelect._FreeSelection(_71,_72,end); } },_createRange:function(_79){ if(null==_79){ return null; } var _7a=FreeSelect._document.createRange(); var _7b=FreeSelect._document.getElementById(_79.start.id); var _7c=FreeSelect._UTIL._restoreIndex(_7b,_79.start.index,true); if(_79.start.type=="text"){ var _7d=_7b.childNodes[_7c]; _7a.setStart(_7d,FreeSelect._UTIL._restoreOffset(_7d,_79.start.offset)); }else{ if(_79.start.type=="element"){ _7a.setStart(_7b,(_7c+_79.start.offset)); } } var end=FreeSelect._document.getElementById(_79.end.id); var _7f=FreeSelect._UTIL._restoreIndex(end,_79.end.index,false); if(_79.end.type=="text"){ var _80=end.childNodes[_7f]; _7a.setEnd(_80,FreeSelect._UTIL._restoreOffset(_80,_79.end.offset)); }else{ if(_79.end.type=="element"){ _7a.setEnd(end,(_7f+_79.end.offset)); } } return _7a; },showSelection:function(_81){ var _82=this._createRange(_81); if(null!=_82){ FreeSelect._window.getSelection().addRange(_82); } },showMarker:function(_83){ FreeSelect._UTIL._showMarker(_83); },hideMarker:function(_84){ FreeSelect._UTIL._hideMarker(_84); },_absoluteTop:function(_85){ var top=_85.offsetTop; while(_85.offsetParent){ top+=_85.offsetParent.offsetTop; _85=_85.offsetParent; } return top; },_absoluteLeft:function(_87){ var _88=_87.offsetLeft; while(_87.offsetParent){ _88+=_87.offsetParent.offsetLeft; _87=_87.offsetParent; } return _88; },clearSelection:function(){ FreeSelect._window.getSelection().removeAllRanges(); },isEmptySelection:function(){ var _89=FreeSelect._window.getSelection(); if(_89.rangeCount==0){ return true; } var r=_89.getRangeAt(0); return (r.startContainer==r.endContainer&&r.startOffset==r.endOffset); }},_addPreMark:function(_8b){ if(_8b.nodeType==1){ _8b._vcc_in_pre=true; }else{ return; } var _8c=_8b.childNodes; for(var i=0;i<_8c.length;++i){ this._addPreMark(_8c[i]); } },fixPreOffset:function(){ var _8e=FreeSelect._document.getElementsByTagName("PRE"); for(var i=0;i<_8e.length;++i){ var pre=_8e[i]; this._addPreMark(pre); } },_instance:null,getInstance:function(){ if(!this._instance){ if(FreeSelect._document.createRange){ this._instance=this._FF; }else{ if(FreeSelect._document.selection){ this._instance=this._IE; }else{ alert(nlsStrings.ALERT_IE_MOZILA); } } } return this._instance; }}; FreeSelect.Selection.prototype.clone=function(){ return new FreeSelect.Selection(this.type,this.target); }; FreeSelect.Selection.prototype.asString=function(){ if(this.type=="free"){ return "{'type':'"+this.type+"','target':"+this.target.asString()+"}"; }else{ if(this.type=="page"){ return "{'type':'"+this.type+"','target':'"+this.target+"'}"; }else{ if(this.type=="element"){ return "{'type':'"+this.type+"','target':'"+this.target+"'}"; }else{ return "{'type':'"+this.type+"'}"; } } } }; FreeSelect.Selection.prototype.equals=function(s){ if(this.type==s.type){ if(this.type=="free"){ return this.target.equals(s.target); }else{ return this.target==s.target; } }else{ return false; } }; FreeSelect._FreeSelection.prototype.clone=function(){ return new FreeSelect._FreeSelection(this.parent,this.start,this.end); }; FreeSelect._FreeSelection.prototype.asString=function(){ return "{'parent':{'id':'"+this.parent.id+"'},"+"'start':{'type':'"+this.start.type+"','id':'"+this.start.id+"','index':"+this.start.index+",'offset':"+this.start.offset+"},"+"'end':{'type':'"+this.end.type+"','id':'"+this.end.id+"','index':"+this.end.index+",'offset':"+this.end.offset+"}}"; }; FreeSelect._FreeSelection.prototype.equals=function(fs){ return fs.asString()==this.asString(); }; 