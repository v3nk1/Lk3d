dojo.declare("vcc.comment.Actions",null,{ViewsFrame:window.top.HelpFrame.NavFrame.ViewsFrame,TabsFrame:window.top.HelpFrame.NavFrame.TabsFrame,showChilds:function(_1){ var _2=_1.parentNode.parentNode; if(_1.className=="shown"){ _1.className="hidden"; _1.src="images/arrowRight.gif"; while(_2.nextSibling){ _2=_2.nextSibling; _2.style.display="none"; } }else{ _1.className="shown"; _1.src="images/arrowDown.gif"; while(_2.nextSibling){ _2=_2.nextSibling; _2.style.display="block"; } } },showOthersComments:function(_3,_4,_5){ this.ViewsFrame.vcc.vccViewFrame.uid=_3; this.ViewsFrame.vcc.vccViewFrame.intranetID=_4; this.ViewsFrame.vcc.vccViewFrame.displayName=_5; this.TabsFrame.showTab("vcc"); this.ViewsFrame.showView("vcc"); },reply:function(_6,_7,_8,_9){ if("null"==_6||null==_6){ theVccFrame.logon.show(); dojo.cookie("AddReplyAfterLogon","{'htmlID':'"+_8+"','subject':'"+_7+"','pid':"+_9+"}",{expires:5}); }else{ var _a=commentContent.createSelection(decodeURIComponent(_8)); commentContent.selectFragment(_a); commentDlg.show("reply",nlsStrings.LABEL_RE_PREFIX+_7,_9); } },show_url:function(_b,_c){ var _d=""; var _e=commentContent.getUrl(); var _f=_e.indexOf("/topic"); var _10=_e.indexOf("?"); var _11; if(_f>-1){ if(_10>-1){ _11=_e.substring(_f+6,_10); }else{ _11=_e.substring(_f+6); } } var _12=commentContent.getPrifix(); if(_12!=null&&_12.length>0){ _d+=_12+"/topic"+_11; } var _13=commentContent.getContentLocale(); _d+="?locale="+_13; var _14=commentContent.getPageID(); _d+="&"+"pageid="+_14+"&"+"htmlid="+_b+"&"+"cid="+_c; if(""!=document.getElementById("show_url"+_c).innerHTML){ document.getElementById("show_url"+_c).style.display="none"; document.getElementById("show_url"+_c).innerHTML=""; document.getElementById("show_url_label"+_c).innerHTML=nlsStrings.LABEL_SHOW_URL; }else{ document.getElementById("show_url"+_c).innerHTML=_d; document.getElementById("show_url"+_c).style.display="block"; document.getElementById("show_url_label"+_c).innerHTML=nlsStrings.LABEL_HIDE_URL; var _15=document.getElementById("show_url"+_c); if(_15){ if(document.createRange){ var _16=document.createRange(); _16.selectNodeContents(_15); var _17=window.getSelection(); _17.removeAllRanges(); _17.addRange(_16); }else{ var _16=document.body.createTextRange(); _16.moveToElementText(_15); _16.moveEnd("character",0); _16.moveStart("character",0); _16.select(); } } } },onfocusUrl:function(cid){ var _19=document.getElementById("show_url"+cid); if(_19){ if(document.createRange){ var _1a=document.createRange(); _1a.selectNodeContents(_19); var _1b=window.getSelection(); _1b.removeAllRanges(); _1b.addRange(_1a); }else{ var _1a=document.body.createTextRange(); _1a.moveToElementText(_19); _1a.moveEnd("character",0); _1a.moveStart("character",0); _1a.select(); } } },deleteCommentwithoutChild:function(_1c,_1d,pID){ var _1f=commentContent.createSelection(decodeURIComponent(_1d)); commentContent.selectFragment(_1f); if(confirm(nlsStrings.CONFIRM_DELETE_COMMENT)){ var _20=commentContent.getPageID(); var _21="CommentServlet?deleteid="+_1c+"&sessionid="+sessionID+"&pageid="+_20; dojo.xhrGet({url:_21+"&uniquerequestid="+new Date().getTime()+"&moderator=no",handleAs:"json",load:function(_22,_23){ commentView.refreshComments(function(){ commentContent.selectFragmentAndDisplayComment(_1f); }); if(_22.value=="0"){ alert(nlsStrings.ALERT_COMMENT_REPLIED); } if(pID==0){ parent.ContentViewFrame.content._marker._hideMarker(_1f); } return _22; }}); } },deleteComment:function(_24,_25,pID){ var _27=commentContent.createSelection(decodeURIComponent(_25)); commentContent.selectFragment(_27); if(confirm(nlsStrings.CONFIRM_DELETE_COMMENT)){ var _28=commentContent.getPageID(); var _29="CommentServlet?deleteid="+_24+"&sessionid="+sessionID+"&pageid="+_28; dojo.xhrGet({url:_29+"&uniquerequestid="+new Date().getTime(),handleAs:"json",load:function(_2a,_2b){ commentView.refreshComments(function(){ var _2c=commentContent.createSelection(decodeURIComponent(_25)); commentContent.selectFragmentAndDisplayComment(_2c); }); if(pID==0){ parent.ContentViewFrame.content._marker._hideMarker(_27); } return _2a; }}); } },changeDisp:function(arg){ var _2e=arg.name; var _2f=document.createElement("DIV"); _2f.appendChild(arg.parentNode.parentNode.previousSibling.cloneNode(true)); _2f.appendChild(arg.parentNode.parentNode.cloneNode(true)); var _30=commentView.findCommentByID(_2e); if(null==_30){ alert(nlsStrings.ALERT_PROCESS_FAIL); } var _31=_30.toHTML; _30.toHTML=function(){ var _32=cmtUtil.decodeCommentSpecial(this.text); var _33=cmtUtil.decodeCommentSpecial(this.subject); var _34=""; if(""!=this.nickName){ _34=this.nickName; }else{ _34=this.intranetID; } var _35="<table><tr class='dt'><td>"+"<strong>"+nlsStrings.LABEL_SUBJECT+"</strong>"+_33+"</td><tr>"; _35+="<tr class='dt'><td>"+"<strong>"+nlsStrings.LABEL_CONTENT+"</strong>"+_32+"</td></tr></table><p class='bt'>"; _35+="<strong>"+nlsStrings.LABEL_OWNER+"</strong>"+_34+"<strong>"+nlsStrings.LABEL_TYPE+"</strong>"+typeList[this.type]; _35+="<strong>"+nlsStrings.LABEL_DISPOSITION+"</strong>"; _35+=commentActions.createDispSelectionHTML(this,dispositionList); _35+="<strong>"+nlsStrings.LABEL_TIME+"</strong>"+this.time; _35+="</p>"; return _35; }; dojo.byId("disproot").innerHTML=_30.toHTML(); _30.toHTML=_31; document.getElementById("dispositionSelection").selectedIndex=_30.disposition; dispositionDlg.show(_30); },createDispSelectionHTML:function(_36,_37){ var _38=document.createElement("DIV"); var _39=document.createElement("select"); _39.id="dispositionSelection"; var _3a=1; if(isIE){ _3a=2; } for(var i=0;i<_37.length-_3a;i++){ var _3c=document.createElement("option"); _3c.value=i; _3c.innerHTML=_37[i]; _39.appendChild(_3c); } var _3d=_36.disposition; var _3e=_37.length-1; if(isIE){ _3e--; } if(_3e==_3d){ var _3c=document.createElement("option"); _3c.value=_37.length-1; _3c.innerHTML=_37[_37.length-1]; _39.appendChild(_3c); _39.disabled=true; } _39.selectedIndex=_3d; _38.appendChild(_39); return _38.innerHTML; }}); var commentActions=new vcc.comment.Actions(); dojo.declare("vcc.comment.CommentFrameView",null,{commentMenu:new vcc.comment.CommentMenu(),commentAmount:0,showLoadingMsg:function(){ alert("Implement showLoadingMsg()."); },insertComment:function(_3f,_40,uid,_42,_43,_44,_45,_46,cid,pid,_49,_4a){ alert("Implement insertComment: function(subject, text, uid, intranetID, nickName, time, type, disposition, cid, pid, selection, doNotUpdateUI);"); },updateCommentAmount:function(){ this.commentMenu.displayCommentAmount(this.commentAmount); this.showCommentTip(); },reset:function(){ this.commentAmount=0; this.commentMenu.displayCommentAmount(this.commentAmount); },updateUI:function(){ this.commentMenu.displayCommentAmount(this.commentAmount); },showCommentsForSelection:function(_4b){ alert("Implement showCommentsForSelection(selection)."); },getCommentedHtmlIDs:function(){ alert("Implement getCommentedHtmlIDs()."); },findCommentByID:function(_4c){ alert("Implement findCommentByID(commentID)."); },commentsRetrieved:false,retrieveComments:function(_4d){ if(this.commentsRetrieved){ return; } this.refreshComments(_4d); },refreshComments:function(_4e){ if(!commentContent.isCommentAble()){ return; } commentView.showLoadingMsg(); var _4f; if(_4e){ _4f=function(_50,_51){ commentView.retrieveCommentsHandler(_50,_51); _4e(); }; }else{ _4f=this.retrieveCommentsHandler; } var _52=commentContent.getPageID(); var _53=commentContent.getPluginVersion(); var _54=vccUtils.getTimezoneName(); dojo.xhrGet({url:AJAX.getRootPath()+"InitialCommentServlet?pageid="+_52+"&pluginVersion="+_53+"&contentLocale="+commentContent.getContentLocale()+"&bTimezone="+_54+"&uniquerequestid="+new Date().getTime(),handleAs:"xml",headers:{"content-type":"text/xml; charset=UTF-8"},load:_4f}); },retrieveCommentsHandler:function(_55,_56){ if(_55!=null){ if(_55.getElementsByTagName("error").length!=0){ if(_55.getElementsByTagName("error")[0].firstChild.nodeValue=="Session timeout"){ window.top.location.reload(); } }else{ var _57=_55.getElementsByTagName("comment"); commentView.reset(); for(var i=0;i<_57.length;i++){ var _59=cmtUtil.getElementText(_57[i],"htmlID"); var _5a=cmtUtil.getElementText(_57[i],"subject"); var _5b=cmtUtil.getElementText(_57[i],"text"); var uid=cmtUtil.getElementText(_57[i],"uid"); var _5d=cmtUtil.getElementText(_57[i],"intranetID"); var _5e=cmtUtil.getElementText(_57[i],"nickName"); var _5f=cmtUtil.getElementText(_57[i],"timestamp"); var _60=cmtUtil.getElementText(_57[i],"typeID"); var _61=cmtUtil.getElementText(_57[i],"dispositionID"); var cid=cmtUtil.getElementText(_57[i],"cid"); var pid=cmtUtil.getElementText(_57[i],"pid"); if(null==_59){ continue; } var _64=commentContent.createSelection(decodeURIComponent(_59)); commentView.insertComment(_5a,_5b,uid,_5d,_5e,_5f,_60,_61,cid,pid,_64,true); } commentView.updateUI(); } } this.commentsRetrieved=true; },showCommentTip:function(){ var _65=dojo.byId("message"); var _66=dojo.byId("commentTip"); if(commentContent.isCommentAble()&&commentContent.isLatestVersion()&&this.commentAmount==0&&!isAdministrator&&!isModerator){ if(_65){ _65.style.visibility="hidden"; } if(_66){ _66.style.display="block"; } }else{ if(_66){ _66.style.display="none"; } if(_65&&this.commentAmount>0){ _65.style.visibility="visible"; } } },hideCommentTip:function(){ var _67=dojo.byId("message"); var _68=dojo.byId("commentTip"); if(_68){ _68.style.display="none"; } if(_67&&this.commentAmount>0){ _67.style.visibility="visible"; } }}); 